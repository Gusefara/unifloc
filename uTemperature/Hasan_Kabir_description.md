## Описание методики расчета температуры в Hasan_Kabir_class (пока единственной)
Источник:
Al-Safran E. M., Brill J. P. Applied multiphase flow in pipes and flow assurance: oil and gas production. – SPE, 2017.
###  Основное уравнение:
$$
T_f = (T_{ei} - g_G L sin\theta) + (T_{fi} - T_{ei})e^{-L/A} + A (1 - e^{-L /A })(g_G sin\theta - \frac{gsin\theta}{C_p} + F_c)
$$

### Расчет конвективного теплообмена в скважине
1. Расчет скорости  смеси и содержание жидкости в потоке без учета проскальзывания:
$$
A_p = \frac{\pi}{4}d^2
$$
$$
v_{SL} = \frac{q_L}{A_p}
$$
$$
v_{Sg} = \frac{q_g}{A_p}
$$
$$
v_m = v_{SL} + v_{Sg}
$$
$$
\lambda_L = \frac{v_{SL}}{v_m}
$$
2. Расчет физических и термических свойств смеси:
$$
\rho_n = \rho_L \lambda_L + \rho_g (1 - \lambda_L)
$$
$$
\mu_n = \mu_L \lambda_L + \mu_g (1 - \lambda_L)
$$
$$
k_n = k_L \lambda_L + k_g (1 - \lambda_L)
$$
$$
C_{p_n} = \frac {[C_{p_L} \rho_L \lambda_L +C_{p_g} \rho_g (1 - \lambda_L)]} {\rho_n} 
$$
3. Расчет числа Рейнольдса, Прандтля и Нуссельта
$$
N_{Re_n} = \frac{\rho_n v_m d _{ti}}{\mu_n}
$$
$$
N_{Pr_n} = \frac{\mu_n C _{P_n}}{k_n}
$$
$$
N_{Nu} = 0.023 N_{Re_n} ^ {0.8} N_{Pr_n} ^ {0.3}
$$
$$
h_f = \frac{N_{Nu}k_n}{d_{ti}}
$$
### Естественная конвекция в затрубном пространстве

1. Расчет безразмерных чисел Прандтля и Грасгофа для затрубного пространства
$$
N_{Pr} = \frac{\mu_{an} C _{P_{an}}}{k_{an}}
$$
2. Предполагаем неизменяемость физических и термических свойств флюида в затрубном пространстве и принимаем:

$$
(T_{to} - T_{ci}) = 3^{\circ}
$$
и можем рассчитать:
$$
N_{Gr} = \frac {(r_{ci} - r_{to})^3 \bar{\rho}_{an}^2 \beta g (T_{to} - T_{ci}) }{\bar{\mu}_{an}^2}
$$
3. Рассчитаем коэффициент естественной конвекции:
$$
h_{an} = \frac{0.049(N_{Gr} N_{Pr}) ^ {(1/3)} N_{Gr} ^ {0.074} k_{an}}{r_{to}ln(\frac{r_{ci}}{r_{to}})}
$$
4. Скорректируем коэффициент для учета длины трубы
$$
h_{an}^{*} = 0.25 h_{an}
$$
### Определение общего коэффициента теплопередачи:
1. Рассчитываем безразмерное время и безразмерный коэффциент теплопроводности Земли
$$
t_{Dw} = \frac{k_e t}{\rho_e C_{p_e}r_{w}^2}
$$
$$
t_{Dw} \leq 1.5  \to f(t) = 1.1281\sqrt {t_{Dw}} ( 1 - 0.3 \sqrt {t_{Dw}} )
$$
$$
t_{Dw} > 1.5  \to f(t) = [0.4063 + 0.5 ln(t_{Dw})] ( 1 - 0.6 /t_{Dw} )
$$
2. Определяем термическое сопротивление элементов
$$
(R_{conv})_f = \frac{1}{r_{ti}h_f}
$$
$$
(R_{cond})_t  = \frac{ln(r_{to}/r_{ti})}{k_t}
$$
$$
(R_{conv})_{an} = \frac{1}{r_{ci}h_{an}}
$$
$$
(R_{cond})_c  = \frac{ln(r_{co}/r_{ci})}{k_c}
$$
$$
(R_{cond})_{cem}  = \frac{ln(r_{w}/r_{co})}{k_{cem}}
$$
$$
(R_{cond})_{e}  = \frac{f(t)}{k_{e}}
$$
3. Определяем общий коэффициент теплопередачи
$$
U  = \frac{1}{r_{to}}[\frac{1}{ (R_{conv})_f + (R_{cond})_t + (R_{conv})_{an} +(R_{cond})_c + (R_{cond})_{cem}+(R_{cond})_{e} }]
$$

### Итоговый набор формул:
1. Рассчитываем газовый фактор и общий массовый расход смеси:
$$
R_p = \frac{q_g}{q_L}
$$
$$
\dot{m}_T = \rho_n v_m A_p
$$
2. Рассчитываем еще параметры:
$$
A = \frac{\dot{m}_T  C_{pm}}{\pi d_{to}U}
$$
$$
F_c = -2.978*10^{-3} + 1.006 * 10 ^ {-6} p_{wh} + 1.906 *10^{-4}\dot{m}_T -1.047 * 10^{-6} R_p+ 3.229 * 10^{-5} \gamma_{API} + 4.009 * 10^{-3} \gamma_g - 0.3551g_G
$$
3. Рассчитаем температуру флюида в искомой точке:
$$
T_f = (T_{ei} - g_G L sin\theta) + A (1 - e^{-L /A })(g_G sin\theta - \frac{gsin\theta}{C_p} + F_c)
$$
4. Определим величину теплового потока
$$
T_{wh} = T_r - g_G L sin \theta
$$
$$
q = 2 \pi r_{to}U (T_f - T_{wh})
$$
5. Расчитаем перепад температур в затрубном пространстве
$$
(T_{to} - T_{ci})_C = \frac{q}{2\pi r_{ti} h_{an}}
$$
6. Повторяем весь цикл расчета пока не будет изменяться разница температур в затрубном пространстве

